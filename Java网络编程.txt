************** Java网络编程 ****************

### 基本网络概念
# 网络
通常通过线缆连接，数据位转换为电磁波，通过线缆移动。无线网络会通过无线电波传输数据，长距离传输会通过玻璃纤维发送可见光传输数据
网络中的媚态机器称为一个节点（node），大多数节点是计算机，但是打印机、路由器、网桥、网关、哑终端和可口可乐机都是节点。具有完备功能的计算机节点称为主机（host）。
每个网络节点都有地址(address),用于唯一标识节点的一个字节序列，可以将这一字节序列视为数字，每个地址中的字节越多，可用的地址就越多，就能有更多的设备同时连入网络。
不同的网络会以不同的方式分配地址，以太网（Ethernet）地址与物理以太网硬件关联。
有些网络中，节点还有进行标识的名字，例如"www.google.com"，某一时刻一个特定的名字通常就指示一个地址，但是名字和地址并不锁定，名字可以改变，但是地址不变。类似的，地址可以改变而名字不变。一个地址可以有多个名字，名字也可以有多个地址。
所有现代计算机网络都是包交换（分组交换）网络，流经网络的数据分割成小块，称为包（packet，也称分组），每个包都单独加以处理。每个包都包含了由谁发送和将发往何处的信息。将数据分成单独的带有地址的包，最重要的优点是，多个即将交换的包可以在一条线缆上传输，这使得建立网络的成本更低，多个计算机可以互不干扰得共用同一条线缆。还有一个好处是，可以进行校验，用来检测包在传输中是否遭到破坏。
协议（protocol）是定义计算机如何通信的一组明确的规则：包括地址格式、数据如何分包等。针对网络通信的不同方面，定义有很多不同的协议。如：超文本传输协议（Hypertext Transfer Protocol， Http），定义了Web浏览器如何与服务通信，等等
# 网络的分层
通过网络发送数据时一项复杂的操作，必须仔细地协调网络的物理特性和所发送数据模拟信号，检测和修正错误。
网络通信的不同方面给分解为多个层，每一层表示为物理硬件（即线缆和电流）与所传输信息之间的不同抽象层次。理论上，每一层只与紧挨的上下两层对象。分层可以修改甚至替换某一层的软件，只要层与层之间的接口保持不变，就不会影响其他层。
Internet标准的TCP/IP四层模型
应用层 < --------------------> 应用层     # 逻辑上是应用层相互交换数据 实际上则是通过了4层模型
    |                           |
传输层TCP/UDP                  传输层TCP/IP
    |                           |
网际层IP                       网际层IP
    |   ------->物理路径-------->|
        主机网络层(以太网、WIFI、LTE等）
主机网络层
基于IP的Internet的标准参考模型中，网络中隐藏的部分属于主机网络层（host-work layer），也称为链路层、数据链路层或网络接口层。
主机网络层中，由连接不同计算机的硬件（线缆、光纤电缆、无线电波或烟信号）组成的部分有时称为物理层，Java网络编程中无需考虑
网际层
需要考虑的第一层，OSI模型中，也称为网络层（network-layer）。网络层协议定义了数据位和字节如何组织为更大的分组，称为包，还定义了寻址机制，不同计算机按照这个寻址机制查找对方。网际协议（IP）是世界上使用最广泛的网络层协议，也是Java唯一理解的网络层协议
IP分为两个协议IPv4和IPv6，IPv4使用32位地址、IPv6使用128位地址，另外增加了一些技术特性帮助完成路由。
IPv4和IPv6中，数据按包在网际层上传输，称为数据报（datagram），每个IPv4数据报包含一个长度为20到60字节的首部，以及一个包含多达65515字节数据的有效载荷（payload），实际上，大多数IPb4的数据报小很多，从几十字节到稍大于8k字节不等。IPv6包含一个更大的首部，数据可以多达4G
除了路由和寻址，网际层第二个作用是支持不同类型的主机网络层相互对话。
传输层
原始数据报有一些缺点，最显著的是不能保证可靠传送，即使能传送也可能在传输中遭到破坏，首部校验和只能校验首部中的破坏情况，而不能检测数据报中的数据部分。即使数据报能未糟破坏的到达目的地，也不一定是按照发送的顺序到达，各个数据报可能会经过不同路由从源到达目的地。
传输层（transport layer）负责确保各包以发送顺序接受，并保证没有数据丢失或破坏，如果丢包则要求发送方重传。IP网络会给每个数据报添加一个附加首部，其中包含更多信息。这一层上主要有两个协议，一个是传输控制协议（Transmission Control Protocol TCP)，这是一个开销很高的协议，支持对丢失或破坏的数据进行重传，并按照发送时的顺序进行传送。第二个是用户数据报协议（User Datagram Protocol UDP），允许接受放检测被破坏的包，但不保证这些包以正确的顺序传送（或者包有可能根本未传送），但是UDP通常比TCP块。
应用层
向用户传送数据的层称为应用层。应用层协议有很多。比如HTTP FTP SMTP POP等
IP、TCP和UDP
IP允许任意两点之间有多个路由器，开放、与平台无关的，可以将TCP置于IP之上，使得连接的两端可以确认收到IP包，以及请求重传丢失或被破坏的包。TCP允许接收端的包按照发送时的顺序重新组合到一起。
TCP开销很大，如果顺序不太重要，而且单个包丢失不会完全破坏数据流，就可以使用UDP发送数据包。
可以在IP协议上运行的还有很多其他协议，比如ICMP，主要用于PING。Java不支持ICMP，也不支持原始IP数据报。Java只支持TCP/UDP和建立在之上的应用层协议。
IP地址和域名
IPv4网络中的每台计算机都又一个四字节的数字标识，一般写为点分四段（dotted quad）格式，比如127.0.0.1.每段都是一个无符号字节，范围从0到255，IPv4网络中的每台计算机都又唯一的四字节地址，当数据通过网络传输时，包的首部会包括要发往的机器地址和发送包的及其地址。沿路的路由器通过检查目的地址来选择发送数据包的最佳路由。
IPv4的地址优先，现在已经所剩无几，逐渐向IPv6过度。IPv6分为8段，每段由:分隔，每段是4个16进制的数字组成。前导的0不用写，Java1.4版本之后才支持IPv6
域名系统用于将易于以及的主机名转换为主机地址。
有一些地址区块和模式很特殊，以10.、172.16.、172.31.、192.168.开头的所有IPv4地址都为分配，可以在内部网使用，不允许加入全球Internet。127开头的地址（常见的是127.0.0.1）总表示本地会送地址，也就是说这些地址总指向本地计算机，而无论在哪个计算机上运行，这个地址的主机名通常是localhost。IPv6中则是0:0:0:0:0:0:0:1 也就是::1.而地址0.0.0.0总指示其实主机，但只能用于源地址，而不能用于目标地址。
4字节都使用相同数字的IPv4地址（如255.255.255.255）是一个广播地址，发送到这个地址的包将由本地网络上的所有节点接受。
端口
同时需要处理多个网络流，通过端口实现。每台有IP地址的计算机都又几千个逻辑端口（每个传输层协议都有65535个端口），这些只是内存中的抽象，不表示任何物理实物，与USB端口不同，每个端口由1到65535之间的一个数字标识，可以分配给一个指定的任务。
1到1023端口号保留给已知的服务，如finger、FTP、HTTP和IMAP。UNIX和LINUX中只有root可以接受，任何用户可以发送，Windows中所有程序都可以使用，无需额外的授权。
已知端口分配
echo                7           TCP/UDP             测试协议，通过回显另一台机器的输入来验证能否连接
discard             9           TCP/UDP             用处不大的协议，将忽视服务器接收到的所有数据
daytime             13          TCP/UDP             提供服务器当前时间的ASCII表示
FTP                 20          TCP                 使用两个已知端口，这个用于传输文件
FTP                 21          TCP                 这个用来发送FTP命令，比如put和get
SSH                 22          TCP                 用于加密的远程登录
Telnet              23          TCP                 用于交互式远程命令行会话
smtp                25          TCP                 简单邮件传输协议
time                37          TCP/UDP             时间服务器返回服务器从1990-01-01后过去的描述，这是一个4字节带有符号的big-endian整数
whois               43          TCP                 用于Internet网络管理的简单目录服务
finger              79          TCP                 返回本地系统中用户（或多个用户）有关信息的服务
HTTP                80          TCP                 国际互联网的底层协议
POP3                110         TCP                 邮局协议版本3
NNTP                119         TCP                 新闻传输
IMAP                143         TCP                 Internet消息访问协议是访问存储在服务器上的邮箱的协议
HTTPS               443         TCP                 SSH的HTTP
Internet
是世界上最大的基于IP的网络。Internet中每台计算机都至少有一个标识此计算机的IP地址，大多数还有至少一个主机名映射到这个IP地址。
Internet不是唯一的基于IP的网络，但却是最大的一个，其他IP网络称为internet
Internet地址分块
区域Internet注册机构会为Internet服务提供商（ISP）分配IPv4地址块，当需要连接基于IP的网络连接时，ISP会分配给一个地址。如果前缀216.254.85，那么可以使用216.254.85.0-216.265.85.255的地址，由于固定了前24位，称为/24。/23则说明固定了23位，有512个地址可以使用，
网络地址转换
网络地址转换(Net Address Transaction, NTA)，基于NAT网络中，大多数节点只有不可路由的本地地址，从10.x.x.x/172.16.x.x/172.31.x.x或192.168.x.x选择，将本地网络连接到ISP的路由器会把这些本地地址转换为更小的一组可路由的地址
































